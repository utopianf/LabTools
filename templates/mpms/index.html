<!DOCTYPE HTML>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

</head>
<body>
    {% for curve in object_list %}
        <li><button class="curve-button" id="curve-{{ curve.id }}" type="button" value="{{ curve.id }}">{{ curve.id }}-{{ curve.sequence }}</button></li>
    {% endfor %}
    <div id="chart_div"></div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        $().ready(function(){
            $.ajax({
                url: 'http://localhost:3000/api/curve/1/get_data_points/',
                type: 'GET',
                contentType: false,
                processType: false,
                cache: false,
                success: function(response){
                    google.charts.load('current', {packages: ['corechart', 'line']});
                    google.charts.setOnLoadCallback(drawBasic);

                    function drawBasic() {

                        var data = new google.visualization.DataTable();
                        data.addColumn('number', response.xAxis);
                        data.addColumn('number', response.yAxis);

                        data.addRows(response.dataPoints.map(function (e) {
                            return [e.x, e.y];
                        }));

                        var options = {

                            hAxis: {
                                title: response.xAxis,
                            },
                            vAxis: {
                                title: response.yAxis
                            }
                        };

                        var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

                        chart.draw(data, options);
                        console.log(chart.getSelection());

                        google.visualization.events.addListener(chart, 'select', selectHandler);

                        function selectHandler(e) {
                            var selection = chart.getSelection();
                            console.log(selection);
                            alert(data.getValue(selection[0].row, 0)+","+data.getValue(0, selection[0].column));
                        }
                    }
                }
            })
        })

        $(function(){
            $('.curve-button').click(function(){
                var curve_id = $(this).val();
                $.ajax({
                    url: 'http://localhost:3000/api/curve/'+curve_id+'/get_data_points/',
                    type: 'GET',
                    contentType: false,
                    processType: false,
                    cache: false,
                    success: function(response){
                        google.charts.load('current', {packages: ['corechart', 'line']});
                        google.charts.setOnLoadCallback(drawBasic);

                        function drawBasic() {

                            var data = new google.visualization.DataTable();
                            data.addColumn('number', response.xAxis);
                            data.addColumn('number', response.yAxis);

                            data.addRows(response.dataPoints.map(function (e) {
                                return [e.x, e.y];
                            }));

                            var options = {
                                hAxis: {
                                    title: response.xAxis
                                },
                                vAxis: {
                                    title: response.yAxis
                                }
                            };

                            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

                            chart.draw(data, options);
                        }
                    }
                })
            })
        })
    </script>
</body>
</html>